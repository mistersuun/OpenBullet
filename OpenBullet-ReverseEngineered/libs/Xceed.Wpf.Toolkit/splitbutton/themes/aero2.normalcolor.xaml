<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:chrome="clr-namespace:Xceed.Wpf.Toolkit.Chromes"
                    xmlns:local="clr-namespace:Xceed.Wpf.Toolkit"
                    xmlns:themes="clr-namespace:Xceed.Wpf.Toolkit.Themes"
                    xmlns:conv="clr-namespace:Xceed.Wpf.Toolkit.Core.Converters">
  <ResourceDictionary.MergedDictionaries>
    <ResourceDictionary Source="../../Themes/Aero2/Common.xaml"/>
    <ResourceDictionary Source="../../Themes/Aero2/Glyphs.xaml"/>
  </ResourceDictionary.MergedDictionaries>
  <conv:InverseBoolConverter x:Key="InverseBoolConverter"/>
  <conv:ThicknessSideRemovalConverter x:Key="ThicknessSideRemovalConverter"/>
  <Style TargetType="{x:Type local:SplitButton}">
    <Setter Property="Control.BorderThickness" Value="1"/>
    <Setter Property="Control.IsTabStop" Value="false"/>
    <Setter Property="Control.HorizontalContentAlignment" Value="Center"/>
    <Setter Property="Control.VerticalContentAlignment" Value="Center"/>
    <Setter Property="Control.Background"
            Value="{DynamicResource {x:Static themes:ResourceKeys.ButtonNormalBackgroundKey}}"/>
    <Setter Property="Control.BorderBrush"
            Value="{DynamicResource {x:Static themes:ResourceKeys.ButtonNormalOuterBorderKey}}"/>
    <Setter Property="local:DropDownButton.DropDownContentBackground"
            Value="{StaticResource PanelBackgroundBrush}"/>
    <Setter Property="Control.Padding" Value="3"/>
    <Setter Property="Control.Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type local:SplitButton}">
          <Grid x:Name="MainGrid" SnapsToDevicePixels="true">
            <chrome:ButtonChrome x:Name="ControlChrome" Background="{TemplateBinding Control.Background}"
                                 RenderEnabled="{TemplateBinding UIElement.IsEnabled}" BorderThickness="0">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button x:Name="PART_ActionButton" Margin="0"
                        HorizontalContentAlignment="{TemplateBinding Control.HorizontalContentAlignment}"
                        VerticalContentAlignment="{TemplateBinding Control.VerticalContentAlignment}"
                        Padding="{TemplateBinding Control.Padding}" Style="{x:Null}">
                  <Control.Template>
                    <ControlTemplate TargetType="{x:Type Button}">
                      <ContentPresenter/>
                    </ControlTemplate>
                  </Control.Template>
                  <Grid>
                    <chrome:ButtonChrome x:Name="ActionButtonChrome" Background="{TemplateBinding Control.Background}"
                                         Foreground="{TemplateBinding Control.Foreground}"
                                         BorderBrush="{TemplateBinding Control.BorderBrush}"
                                         RenderEnabled="{TemplateBinding UIElement.IsEnabled}"
                                         BorderThickness="{Binding BorderThickness, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ThicknessSideRemovalConverter}, ConverterParameter=2}"
                                         RenderMouseOver="{Binding IsMouseOver, ElementName=PART_ActionButton}"
                                         RenderPressed="{Binding IsPressed, ElementName=PART_ActionButton}">
                      <ContentPresenter Name="ActionButtonContent" Margin="{TemplateBinding Control.Padding}"
                                        Content="{TemplateBinding ContentControl.Content}"
                                        ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}"
                                        VerticalAlignment="{TemplateBinding Control.VerticalContentAlignment}"
                                        HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}"
                                        RecognizesAccessKey="true"/>
                    </chrome:ButtonChrome>
                  </Grid>
                </Button>
                <ToggleButton x:Name="PART_ToggleButton" Grid.Column="1"
                              IsChecked="{Binding IsOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                              IsHitTestVisible="{Binding IsOpen, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource InverseBoolConverter}}">
                  <Control.Template>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                      <ContentPresenter/>
                    </ControlTemplate>
                  </Control.Template>
                  <Grid>
                    <chrome:ButtonChrome x:Name="ToggleButtonChrome" Background="{TemplateBinding Control.Background}"
                                         BorderBrush="{TemplateBinding Control.BorderBrush}"
                                         BorderThickness="{TemplateBinding Control.BorderThickness}" Padding="1,0,1,0"
                                         RenderChecked="{TemplateBinding local:DropDownButton.IsOpen}"
                                         RenderEnabled="{TemplateBinding UIElement.IsEnabled}"
                                         RenderMouseOver="{Binding IsMouseOver, ElementName=PART_ToggleButton}"
                                         RenderPressed="{Binding IsPressed, ElementName=PART_ToggleButton}">
                      <Grid x:Name="arrowGlyph" IsHitTestVisible="false" Margin="4,3,4,3">
                        <Path x:Name="Arrow" Width="9" Height="5" Data="{StaticResource DownArrowGeometry}"
                              Fill="{DynamicResource {x:Static JetSystemColors.ControlTextBrushKey}}" Margin="0,1,0,0"/>
                      </Grid>
                    </chrome:ButtonChrome>
                  </Grid>
                </ToggleButton>
              </Grid>
            </chrome:ButtonChrome>
            <Popup x:Name="PART_Popup" HorizontalOffset="1" VerticalOffset="1" AllowsTransparency="true"
                   StaysOpen="false" Placement="{TemplateBinding local:DropDownButton.DropDownPosition}"
                   Focusable="false" IsOpen="{Binding IsChecked, ElementName=PART_ToggleButton}">
              <Border BorderThickness="1" Background="{TemplateBinding local:DropDownButton.DropDownContentBackground}"
                      BorderBrush="{StaticResource PopupDarkBorderBrush}"
                      MaxHeight="{TemplateBinding local:DropDownButton.MaxDropDownHeight}">
                <ScrollViewer x:Name="DropDownScrollViewer" VerticalScrollBarVisibility="Auto">
                  <ContentPresenter x:Name="PART_ContentPresenter" Content="{TemplateBinding local:DropDownButton.DropDownContent}"/>
                </ScrollViewer>
              </Border>
            </Popup>
          </Grid>
          <ControlTemplate.Triggers>
            <Trigger Property="UIElement.IsEnabled" Value="false">
              <Setter TargetName="Arrow" Property="Shape.Fill" Value="#AFAFAF"/>
              <Setter TargetName="ActionButtonChrome"
                      Value="{DynamicResource {x:Static JetSystemColors.GrayTextBrushKey}}" Property="Control.Foreground"/>
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>