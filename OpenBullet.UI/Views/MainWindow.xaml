<Window x:Class="OpenBullet.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="{Binding WindowTitle}"
        Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}">
    
    <materialDesign:DialogHost Identifier="RootDialog" SnackbarMessageQueue="{Binding ElementName=MainSnackbar, Path=MessageQueue}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Top Bar -->
            <materialDesign:ColorZone Grid.Row="0" Mode="PrimaryMid" Padding="16,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Logo and Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="LightningBolt" Width="32" Height="32" Margin="0,0,8,0" />
                        <TextBlock Text="OpenBullet" FontSize="20" FontWeight="Bold" VerticalAlignment="Center" />
                        <TextBlock Text="Professional Web Automation" FontSize="12" Opacity="0.8" VerticalAlignment="Bottom" Margin="8,0,0,2" />
                    </StackPanel>

                    <!-- Navigation Buttons -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Button Style="{StaticResource MaterialDesignToolButton}" 
                                Command="{Binding GoBackCommand}"
                                IsEnabled="{Binding CanGoBack}"
                                ToolTip="Go Back"
                                Margin="4,0"
                                Width="40" Height="40">
                            <materialDesign:PackIcon Kind="ArrowLeft" />
                        </Button>
                        <Button Style="{StaticResource MaterialDesignToolButton}" 
                                Command="{Binding GoForwardCommand}"
                                IsEnabled="{Binding CanGoForward}"
                                ToolTip="Go Forward"
                                Margin="4,0"
                                Width="40" Height="40">
                            <materialDesign:PackIcon Kind="ArrowRight" />
                        </Button>
                        <Button Style="{StaticResource MaterialDesignToolButton}" 
                                Command="{Binding RefreshStatusCommand}"
                                ToolTip="Refresh Status"
                                Margin="4,0"
                                Width="40" Height="40">
                            <materialDesign:PackIcon Kind="Refresh" />
                        </Button>
                    </StackPanel>

                    <!-- Status Indicators -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                        <materialDesign:PackIcon Kind="Database" Margin="0,0,4,0" />
                        <TextBlock Text="{Binding DatabaseStatus}" FontSize="11" />
                        <Ellipse Width="8" Height="8" Margin="8,0,0,0" 
                                 Fill="{Binding IsConnected, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Style="{StaticResource MaterialDesignToolButton}" 
                                Command="{Binding ToggleThemeCommand}"
                                ToolTip="Toggle Theme"
                                Margin="4,0"
                                Width="40" Height="40">
                            <materialDesign:PackIcon Kind="ThemeLightDark" />
                        </Button>
                        
                        <Button Style="{StaticResource MaterialDesignToolButton}" 
                                Command="{Binding BackupDatabaseCommand}"
                                ToolTip="Backup Database"
                                Margin="4,0"
                                Width="40" Height="40">
                            <materialDesign:PackIcon Kind="DatabaseExport" />
                        </Button>

                        <!-- Settings Menu -->
                        <Button Style="{StaticResource MaterialDesignToolButton}" 
                                ToolTip="Settings"
                                Margin="4,0"
                                Width="40" Height="40">
                            <Button.Content>
                                <materialDesign:PackIcon Kind="Cog" />
                            </Button.Content>
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Settings" Command="{Binding NavigateToViewCommand}" CommandParameter="Settings">
                                        <MenuItem.Icon>
                                            <materialDesign:PackIcon Kind="Cog" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator />
                                    <MenuItem Header="Optimize Database" Command="{Binding OptimizeDatabaseCommand}">
                                        <MenuItem.Icon>
                                            <materialDesign:PackIcon Kind="DatabaseCog" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <MenuItem Header="About" Command="{Binding ShowAboutCommand}">
                                        <MenuItem.Icon>
                                            <materialDesign:PackIcon Kind="Information" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator />
                                    <MenuItem Header="Exit" Command="{Binding ExitApplicationCommand}">
                                        <MenuItem.Icon>
                                            <materialDesign:PackIcon Kind="ExitToApp" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                    </StackPanel>
                </Grid>
            </materialDesign:ColorZone>

            <!-- Main Content Area -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Navigation Sidebar -->
                <materialDesign:Card Grid.Column="0" Margin="8" Style="{StaticResource ModernCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Navigation Header -->
                        <TextBlock Grid.Row="0" Text="Navigation" FontSize="16" FontWeight="SemiBold" 
                                   Margin="16,16,16,16" HorizontalAlignment="Center" />

                        <!-- Navigation Items -->
                        <ListBox Grid.Row="1" 
                                 ItemsSource="{Binding NavigationItems}"
                                 SelectedItem="{Binding SelectedNavigationItem}"
                                 Style="{StaticResource MaterialDesignNavigationPrimaryListBox}"
                                 Margin="8,0,8,8">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="12,8">
                                        <materialDesign:PackIcon Kind="{Binding Icon}" Width="24" Height="24" 
                                                                 VerticalAlignment="Center" Margin="0,0,16,0" />
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="Medium" FontSize="14" />
                                            <TextBlock Text="{Binding Description}" FontSize="11" 
                                                       Opacity="0.7" TextWrapping="Wrap" Margin="0,2,0,0" />
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignNavigationPrimaryListBoxItem}">
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="Margin" Value="0,2" />
                                    <Setter Property="MinHeight" Value="60" />
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </Grid>
                </materialDesign:Card>

                <!-- Content Area -->
                <materialDesign:Card Grid.Column="1" Margin="0,8,8,8" Style="{StaticResource ModernCard}">
                    <Grid>
                        <!-- Loading Overlay -->
                        <Grid Background="Black" Opacity="0.5" 
                              Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}"
                              Panel.ZIndex="1000">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                             Value="0" IsIndeterminate="True" Width="50" Height="50" />
                                <TextBlock Text="{Binding BusyMessage}" Foreground="White" 
                                           FontSize="14" Margin="0,16,0,0" HorizontalAlignment="Center" />
                            </StackPanel>
                        </Grid>

                        <!-- Current View Content -->
                        <ContentPresenter Content="{Binding CurrentView}" />
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- Status Bar -->
            <materialDesign:ColorZone Grid.Row="2" Mode="PrimaryDark" Padding="16,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{Binding StatusText}" VerticalAlignment="Center" />
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="Theme" Width="16" Height="16" Margin="0,0,4,0" />
                        <TextBlock Text="{Binding CurrentTheme}" FontSize="11" />
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0,0,0">
                        <materialDesign:PackIcon Kind="Clock" Width="16" Height="16" Margin="0,0,4,0" />
                        <TextBlock Text="{Binding CurrentTime}" FontSize="11" />
                    </StackPanel>
                </Grid>
            </materialDesign:ColorZone>

            <!-- Snackbar for notifications -->
            <materialDesign:Snackbar x:Name="MainSnackbar" Grid.Row="1" Panel.ZIndex="1001" />
        </Grid>
    </materialDesign:DialogHost>
</Window>
