<UserControl x:Class="OpenBullet.UI.Views.ProxyListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="Proxies" FontSize="28" FontWeight="Bold" />
            <TextBlock Text="Manage proxy pools and health monitoring" FontSize="14" Opacity="0.7" />
        </StackPanel>

        <!-- Proxy Management Interface -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Statistics Cards -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <materialDesign:Card Grid.Column="0" Margin="0,0,8,0" Padding="16">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="Total Proxies" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding TotalProxies}" FontSize="24" Margin="0,4,0,0" 
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Grid.Column="1" Margin="4,0" Padding="16">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="Working" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding WorkingProxies}" FontSize="24" Margin="0,4,0,0" 
                                   HorizontalAlignment="Center" Foreground="Green"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Grid.Column="2" Margin="4,0" Padding="16">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="Banned" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding BannedProxies}" FontSize="24" Margin="0,4,0,0" 
                                   HorizontalAlignment="Center" Foreground="Red"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Grid.Column="3" Margin="8,0,0,0" Padding="16">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="Avg Speed" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding AverageSpeed}" FontSize="24" Margin="0,4,0,0" 
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>

            <!-- Action Bar -->
            <materialDesign:Card Grid.Row="1" Margin="0,0,0,16" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBox materialDesign:HintAssist.Hint="Search proxies..." Width="200" Margin="0,0,16,0"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                        <ComboBox materialDesign:HintAssist.Hint="Filter by status" Width="120" Margin="0,0,16,0"
                                  SelectedItem="{Binding StatusFilter}">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Working"/>
                            <ComboBoxItem Content="Banned"/>
                            <ComboBoxItem Content="Untested"/>
                        </ComboBox>
                        <ComboBox materialDesign:HintAssist.Hint="Filter by type" Width="100"
                                  SelectedItem="{Binding TypeFilter}">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="HTTP"/>
                            <ComboBoxItem Content="SOCKS4"/>
                            <ComboBoxItem Content="SOCKS5"/>
                        </ComboBox>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Style="{StaticResource MaterialDesignRaisedButton}" 
                                Command="{Binding ImportProxiesCommand}" Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Import" Margin="0,0,4,0"/>
                                <TextBlock Text="Import"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}" 
                                Command="{Binding TestAllProxiesCommand}" Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="TestTube" Margin="0,0,4,0"/>
                                <TextBlock Text="Test All"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}" 
                                Command="{Binding RefreshCommand}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Refresh" Margin="0,0,4,0"/>
                                <TextBlock Text="Refresh"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </materialDesign:Card>

            <!-- Proxy List -->
            <materialDesign:Card Grid.Row="2" Padding="0">
                <Grid>
                    <DataGrid ItemsSource="{Binding Proxies}" SelectedItem="{Binding SelectedProxy}"
                              AutoGenerateColumns="False" CanUserReorderColumns="False" 
                              CanUserResizeColumns="True" IsReadOnly="True"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column">
                        
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Status" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <materialDesign:PackIcon Kind="{Binding StatusIcon}" 
                                                               Foreground="{Binding StatusColor}" 
                                                               HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Proxy" Binding="{Binding Address}" Width="200"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="80"/>
                            <DataGridTextColumn Header="Country" Binding="{Binding Country}" Width="100"/>
                            
                            <DataGridTemplateColumn Header="Speed" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Speed}" HorizontalAlignment="Center"
                                                   Foreground="{Binding SpeedColor}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Used" Binding="{Binding UsageCount}" Width="80"/>
                            <DataGridTextColumn Header="Last Check" Binding="{Binding LastChecked, StringFormat='MMM dd, HH:mm'}" Width="120"/>
                            <DataGridTextColumn Header="Ban Until" Binding="{Binding BanUntil, StringFormat='MMM dd, HH:mm'}" Width="120"/>

                            <DataGridTemplateColumn Header="Actions" Width="150">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MaterialDesignIconButton}" 
                                                    Command="{Binding DataContext.TestProxyCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Test Proxy">
                                                <materialDesign:PackIcon Kind="TestTube"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}" 
                                                    Command="{Binding DataContext.UnbanProxyCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Unban Proxy">
                                                <materialDesign:PackIcon Kind="CheckCircle" Foreground="Green"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}" 
                                                    Command="{Binding DataContext.DeleteProxyCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Delete Proxy">
                                                <materialDesign:PackIcon Kind="Delete" Foreground="Red"/>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Empty State -->
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                Visibility="{Binding IsEmpty, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <materialDesign:PackIcon Kind="ServerNetworkOutline" Width="64" Height="64" Opacity="0.3"/>
                        <TextBlock Text="No Proxies Found" FontSize="18" FontWeight="SemiBold" 
                                   Margin="0,16,0,8" HorizontalAlignment="Center"/>
                        <TextBlock Text="Import proxy lists to get started with automation" FontSize="12" 
                                   Opacity="0.7" HorizontalAlignment="Center"/>
                        <Button Style="{StaticResource MaterialDesignRaisedButton}" 
                                Command="{Binding ImportProxiesCommand}" Margin="0,16,0,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Import" Margin="0,0,4,0"/>
                                <TextBlock Text="Import Proxies"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </materialDesign:Card>
        </Grid>
    </Grid>
</UserControl>
